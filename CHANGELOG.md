# Changelog

## v0.1.22 (2026-02-26)

- E2E-тесты для конфигуратора (Playwright, 14 тестов)
  - A1-A8: проверка генерации скриптов для disk1, usb1, usb1-part1, custom storage, v1/v2 протоколов, uninstall, форматирования диска
  - S1-S6: security-тесты — отсутствие опасных RouterOS-команд (бэкдор-аккаунты, sniffer, dst-nat, подмена URL, scheduler, VPN-серверы)
- RouterOS SSH-тесты (B1-B9, C) для RouterOS 7.20 и 7.21 CHR
- Интерактивная проверка внешнего диска в генерируемом скрипте
  - Автоматическое определение mount-point через `/disk/get`
  - Предложение форматирования через `/terminal/inkey` + `/disk/format-drive`
  - Извлечение baseDisk из имени с `-part` суффиксом
- Упрощена секция загрузки: проверка "disk not found" вынесена в раннюю проверку
- Job `e2e` в GitHub Actions (параллельно с `test` и `build`, блокирует `release`)
- Исправлены примеры в README: mount-point USB = `usb1` (а не `usb1-part1`), `/disk/format-drive` вместо `/disk format`
- В конфигураторе `usb1/` помечен как common, добавлен `/` к именам дисков в dropdown
- Шаблон описания релизов (`docs/RELEASE_TEMPLATE.md`) — таблица артефактов EN+RU, ссылка на CHANGELOG
- Автоподстановка шаблона в GitHub Releases (`body_path` + `append_body`)
- Таблица форматов артефактов убрана из CHANGELOG.md (перенесена в шаблон релизов)

## v0.1.21 (2026-02-26)

- Добавлена проверка свободного места при установке на внешний накопитель (PR #17, @koxx009)

## v0.1.20 (2026-02-26)

- Обновлен README по минимальным требованиям

## v0.1.19 (2026-02-26)

- Создание CHANGELOG.md, обновление README

## v0.1.18 (2026-02-26)

- Обновление README
- Уточнены требования к диску и RAM (разделены на отдельные пункты)

## v0.1.17 (2026-02-25)

- Ускорение сборки Docker-образов
- Добавлено видео спидтеста

## v0.1.16 (2026-02-25)

- Исправлен баг с таймаутом переподключения
- Обновление документации

## v0.1.15 (2026-02-25)

- Поддержка пользовательского диска в конфигураторе (usb1, usb2, sd1, nvme1, sata1, custom)
- Добавлена архитектура arm/v5
- Оптимизация кода для высокой нагрузки:
  - Batch I/O через `recvmmsg`/`sendmmsg` на Linux (несколько пакетов за один syscall)
  - Zero-alloc генерация junk-пакетов (предвыделенные буферы)
  - Увеличены буферы сокетов до 16 MB (настраивается через `AWG_SOCKET_BUF`)
  - Привязка I/O-горутин к потокам ОС (`runtime.LockOSThread`)
- Изменение именования Docker-образов для 7.20, обновление документации

## v0.1.14 (2026-02-25)

- Обновление уведомлений конфигуратора

## v0.1.13 (2026-02-25)

- Исправление сборщика

## v0.1.12 (2026-02-25)

- Оптимизации Go:
  - Замена `sync.Pool` на горутин-локальные буферы (меньше накладных расходов)
  - Таймаут активности через `atomic.Bool` вместо `time.Now().Unix()` (без аллокаций)
  - Выделенная горутина для проверки таймаутов
  - Блокирующие чтения вместо цикла с `SetReadDeadline`

## v0.1.11 (2026-02-25)

- Добавлены бинарные сборки (без Docker)

## v0.1.10 (2026-02-24)

- Оптимизация runtime overhead:
  - `GOMAXPROCS=2` по умолчанию (настраивается через `AWG_GOMAXPROCS`)
  - Привязка I/O-горутин к потокам ОС
  - Atomic-флаг остановки вместо `select` по каналу
- Версия сборки в логе

## v0.1.9 (2026-02-24)

- Масштабная оптимизация производительности Go:
  - `netip.AddrPort` вместо `*net.UDPAddr` (value type, без аллокаций при сравнении)
  - Атомарный указатель на remote-соединение (lock-free доступ из обеих горутин)
  - Буферы сокетов 2 MB, guard-проверки уровня логирования
- Обновление README

## v0.1.8 (2026-02-24)

- Исправлена ссылка на помощь (PR #5 от @burnedoutman)

## v0.1.7 (2026-02-24)

- Поддержка AmneziaWG v1.5
- Добавлен пользовательский диск в конфигуратор
- Добавлена поддержка RouterOS 7.20 LT (классический формат Docker-образов)

## v0.1.6 (2026-02-24)

- Поддержка AmneziaWG v1.5 и v2
